# Streamlit Dashboard - Forest Fire Detection

This is an interactive Streamlit dashboard for viewing and generating prediction grids from your trained YOLO model.

## Quick Start

### Prerequisites
Make sure you have the project dependencies installed:
```bash
uv sync
```

### Running the App

From the project root directory:
```bash
streamlit run app/streamlit_app.py
```

This will start a local Streamlit server (typically at `http://localhost:8501`).

## Features

### üì∏ Prediction Gallery Tab
- **View Prediction Grids:** Browse through 4 grids of 6 predictions each
- **Navigation:** Use Previous/Next buttons or the slider to move between grids
- **Sorted by Confidence:** Images are automatically sorted by average confidence score
- **Visualizations:** 
  - Green boxes = Ground Truth annotations
  - Red boxes = Model predictions
  - Confidence scores displayed for each prediction

### ‚öôÔ∏è Generate New Samples Tab
- **One-Click Generation:** Click the "Generate New Samples" button
- **Automatic Processing:**
  1. Loads trained model weights
  2. Runs inference on test set
  3. Selects top 24 predictions by confidence
  4. Generates 4 grid visualizations (6 images each)
  5. Saves results to `reports/figures/`
- **Progress Feedback:** Spinner shows while processing
- **Auto-Navigate:** After generation completes, you're taken to the gallery

### üìä Model Performance Page
- Quick stats and metadata
- Model configuration overview
- Information about the prediction grids

## Configuration

The app uses your `configs/config.yaml` file by default. You can change the config path in the sidebar settings.

### Streamlit Settings
Streamlit configuration is stored in `.streamlit/config.toml`:
- Theme: Red primary color (matching fire theme)
- Server: Runs on port 8501
- Minimal toolbar for cleaner UI

## Project Structure

```
app/
‚îú‚îÄ‚îÄ streamlit_app.py           # Main app entry point
‚îî‚îÄ‚îÄ pages/
    ‚îî‚îÄ‚îÄ 01_mainpage.py         # Model performance overview
.streamlit/
‚îî‚îÄ‚îÄ config.toml                # Streamlit configuration
src/forestfires_project/
‚îú‚îÄ‚îÄ visualize.py               # Visualization/grid generation logic
‚îú‚îÄ‚îÄ model.py                   # Model loading and inference
‚îú‚îÄ‚îÄ data.py                    # Data loading utilities
‚îî‚îÄ‚îÄ utils.py                   # Helper functions
```

## Troubleshooting

### "No prediction grids found" error
- Run the "Generate New Samples" tab first to create initial grids
- Or run: `python main.py --pipeline visualize` from the command line

### "File not found" when generating samples
- Check that `configs/config.yaml` path is correct
- Verify that model weights exist at the path specified in config
- Check console logs for details

### Image quality issues
- Images are generated by `visualize.py` as PNG files
- Ensure matplotlib is properly installed

### Performance issues
- YOLOv8n is a nano model, should run quickly on CPU
- If using GPU, verify CUDA is properly configured

## Development

### Adding New Pages
Create new Python files in the `pages/` directory with names like `02_page_name.py`. Streamlit automatically detects them.

### Modifying the Dashboard
- Main app logic: `app/streamlit_app.py`
- Styling: Edit the markdown CSS in the app
- Theme: Edit `.streamlit/config.toml`

### Session State
The app uses Streamlit's session state to track:
- Current grid index (`current_grid`)
- Generation status (`is_generating`)
- Completion flag (`generation_complete`)

## Notes

- **Model Path:** Loaded from config: `models/{project_name}/weights/best.pt`
- **Data Path:** Loaded from config: `data/processed/test/`
- **Output Path:** `reports/figures/predictions_grid_*.png`
- **Batch Processing:** Inference runs on the entire test set
- **Top 24 Selection:** Images selected by average confidence score

## Commands Reference

| Command | Purpose |
|---------|---------|
| `streamlit run app/streamlit_app.py` | Run the dashboard locally |
| `streamlit run app/streamlit_app.py --logger.level=debug` | Run with debug logging |
| `streamlit cache clear` | Clear Streamlit cache |
| `python main.py --pipeline visualize` | Generate grids via CLI |

